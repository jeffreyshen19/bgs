mapboxgl.accessToken="pk.eyJ1IjoiamVmZnJleXNoZW5jYyIsImEiOiJjamE5MDI4YmowMmMzMndzNDdoZmZnYzF5In0.zV3f0WhqbHeyixwY--TyZg";const map=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/light-v11",center:[-74,40],zoom:6,minZoom:3,projection:"mercator"});function getLocation(){return new Promise((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{e(t.coords)}):t()})}function updateMap(){const e="percent"===document.getElementById("weighting").value,t=document.getElementById("select"),a=t.options[t.selectedIndex],o={name:t.value,weight:a.getAttribute("data-weighting"),max:+a.getAttribute("data-max"),color:a.getAttribute("data-color")},n=["case",["==",["to-number",["get",o.weight]],0],"#ffffff",["interpolate",["linear"],["/",["to-number",["get",o.name]],e?["to-number",["get",o.weight]]:1],0,"#ffffff",e?1:o.max,o.color]];map.getLayer("bgs")?map.setPaintProperty("bgs","fill-color",n):map.addLayer({id:"bgs",type:"fill",source:"tileset","source-layer":"bgs",paint:{"fill-opacity":.7,"fill-color":n}})}map.on("load",()=>{getLocation().then(e=>{e&&map.flyTo({center:[e.longitude,e.latitude],zoom:10})}),map.addSource("tileset",{type:"vector",url:"mapbox://jeffreyshencc.snap",promoteId:"GEOID"}),updateMap(),map.addLayer({id:"bgs-boundary",type:"line",source:"tileset","source-layer":"bgs",minzoom:9,paint:{"line-color":["case",["==",["feature-state","click"],!0],"#c44d56","#bdc3c7"],"line-width":["case",["==",["feature-state","click"],!0],1,.5]}})}),map.addControl(new mapboxgl.FullscreenControl,"bottom-right");const nav=new mapboxgl.NavigationControl({visualizePitch:!0});function addCommas(e){var t=e.toString().split(".");const a=t[0],o=t[1];return a.replace(/\B(?=(\d{3})+(?!\d))/g,",")+(o?"."+o:"")}map.addControl(nav,"bottom-right");const popup=new mapboxgl.Popup({closeButton:!1,offset:[0,-15]});let selectedId;function generatePopup(e){selectedId&&map.setFeatureState({source:"tileset",sourceLayer:"bgs",id:selectedId},{click:!1});const t=map.queryRenderedFeatures(e.point,{layers:["bgs"]});if(!t.length)return void popup.remove();const a=t[0];map.setFeatureState({source:"tileset",sourceLayer:"bgs",id:a.id},{click:!0}),selectedId=a.id;const o=[{name:"medicarecaid_only",label:"With Medicare/Medicaid Coverage Only",weight:"population"},{name:"medicarecaid",label:"With Medicare/Medicaid Coverage",weight:"population"},{name:"snap_households",label:"Households on Food Stamps/SNAP (in the past year)",weight:"households"},{name:"white",label:"White (non-Hispanic)",weight:"population"},{name:"black",label:"Black (non-Hispanic)",weight:"population"},{name:"hispanic",label:"Hispanic",weight:"population"},{name:"asian",label:"Asian (non-Hispanic)",weight:"population"},{name:"aian",label:"Alaska Native/American Indian (non-Hispanic)",weight:"population"},{name:"nhpi",label:"Native Hawaiian/Pacific Islander (non-Hispanic)",weight:"population"}];let n="";for(const e of o){const t=+a.properties[e.name],o=+a.properties[e.weight],i=o?t/o*100:null;n+=`<p style = "margin-top:0;margin-bottom:0"><strong>${e.label}</strong>: ${addCommas(t)}${null!==i?` (${i.toFixed(2)}%)`:""}</p>`}popup.setLngLat(e.lngLat).setHTML(`<span class = "heading">Block Group ${a.properties.GEOID}</span>\n    ${n}\n    `).addTo(map)}map.on("click",generatePopup);